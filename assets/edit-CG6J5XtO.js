import{ai as O,r as l,p as v,X as M,R as I,a9 as P,A as T,o as y,c as $,a as s,b as r,i as X,Y as B,w as _,e as S,t as k,u,_ as b,an as Y,ao as Z,ap as G,aq as H,ar as J,a2 as C,a3 as F,a5 as K,ag as x,ah as w,F as Q,f as W,Z as tt,I as E,g as et,ac as ot,ad as at}from"./index-iXE1tgq1.js";import"./dropzone-DWIWGpu4.js";import{S as st,a as nt}from"./StockCountList-B8r89IFL.js";const ct={class:"grid grid-cols-12 gap-6"},rt={class:"col-span-12"},lt={class:"intro-y box p-4 rounded-lg"},ut={class:"col-span-12 text-right mt-4"},it={__name:"EditStockCount",props:{createStockCountForm:{type:Object,required:!0},form:{type:Object,required:!0},isloading:{type:Boolean,required:!0}},emits:["update-loading"],setup(D,{emit:i}){const m=O(),o=D,n=l([]),f=l(0),c=l(0),d=l("percent"),g=l(new Set),L=l(!0),h=i,R=v(()=>Y(n.value));v(()=>Z(n.value)),v(()=>G(n.value)),v(()=>H(d.value,f.value,c.value,R.value)),v(()=>J(n.value));const N=M();l(!1),l(!1),I(new P);function V(t){if(g.value.has(t.id)){alert("This product is already in the invoice.");return}console.log("productproduct",t),n.value.push({...t,expected:(t==null?void 0:t.expected)||0,counted:(t==null?void 0:t.counted)||0,difference:(t==null?void 0:t.difference)||0,cost:(t==null?void 0:t.cost)||2}),g.value.add(t.id)}function j(t){const a=n.value[t];a!=null&&a.id&&g.value.delete(a.id),n.value.splice(t,1)}const z=async()=>{try{h("update-loading",!0);const t=await C.stockCount.show(N.params.uuid),a=F(t);a.success&&(o.createStockCountForm.count_date=a.data.data.count_date,o.createStockCountForm.count_name=a.data.data.count_name,o.createStockCountForm.notes=a.data.data.notes,o.createStockCountForm.id=a.data.data.id,a.data.data.products.map(e=>{var q;return console.log("item",e),{id:e.id,name_en:(q=e.product)==null?void 0:q.name_en,cost:e.cost,counted:e.counted,difference:e.difference,expected:e.expected,initial_quantity:e.expected,product:e.product,product_id:e.product_id}}).forEach(e=>{V(e)}),h("update-loading",!1))}catch(t){const a=K(t);h("update-loading",!1),console.error("Error fetching stock details:",a),x().fry(w.StockCount.error(a.message))}finally{L.value=!1,console.log("Loading state set to false")}},A=async()=>{try{o.createStockCountForm.isloading=!0;const t={_method:"PUT",count_name:o.createStockCountForm.count_name,count_date:o.createStockCountForm.count_date,notes:o.createStockCountForm.notes,is_draft:0,products:n.value.map(e=>({id:e.id,product_id:e.product.id,expected:e.initial_quantity,counted:e.counted,difference:Number(e.initial_quantity-e.counted),cost:e.cost_price}))};console.log("count stock payload",t);const a=await C.stockCount.edit(N.params.uuid,t),p=F(a);p.success&&(console.log("count stockresponse.status",p),o.createStockCountForm.isloading=!1,m.push("/inventory/stock-count"))}catch(t){console.log("error.response.data.errors",t),o.form.setErrors(t.errors),x().fry(w.StockCount.error(t.message))}finally{o.createStockCountForm.isloading=!1}},U=async()=>{try{o.createStockCountForm.isloading=!0,console.log("SaveDraftStock try",n.value);const t={count_name:o.createStockCountForm.count_name,count_date:o.createStockCountForm.count_date,notes:o.createStockCountForm.notes,is_draft:1,products:n.value.map(e=>({product_id:e.product_id,expected:e.initial_quantity,counted:e.counted,difference:Number(e.initial_quantity-e.counted),cost:e.cost_price}))};console.log("count stock payload",t);const a=await C.stockCount.create(t),p=F(a);p.success&&(console.log("count stockresponse.status",p),m.push("/inventory/stock-count"),o.createStockCountForm.isloading=!1)}catch(t){console.log("error.response.data.errors",t),o.form.setErrors(t.errors),x().fry(w.StockCount.error(t.message))}finally{o.createStockCountForm.isloading=!1}};return T(()=>{z()}),(t,a)=>(y(),$("div",null,[s("div",ct,[s("div",rt,[s("div",lt,[r(st,{"added-product-ids":g.value,onAddProduct:V,createStockCountForm:o.createStockCountForm,form:o.form},null,8,["added-product-ids","createStockCountForm","form"]),n.value.length>0?(y(),X(nt,{key:0,products:n.value,createStockCountForm:o.createStockCountForm,onRemoveProduct:j},null,8,["products","createStockCountForm"])):B("",!0)])])]),s("div",ut,[r(u(b),{variant:"primary",onClick:U,class:"mr-2 mt-2 shadow-md"},{default:_(()=>[S(k(t.$t("stock-count.saveDraft")),1)]),_:1}),r(u(b),{variant:"primary",onClick:A,class:"mr-2 mt-2 shadow-md"},{default:_(()=>[S(k(t.$t("stock-count.updateNewButton")),1)]),_:1})])]))}},dt={class:"flex items-center mt-8 intro-y"},mt={class:"mr-auto text-lg font-medium"},ft={class:"grid grid-cols-12 gap-6 mt-5"},pt={class:"col-span-12 intro-y lg:col-span-12"},_t={class:"intro-y box p-8"},vt={class:"grid grid-cols-12 gap-6"},kt={class:"col-span-6"},gt={class:"col-span-12"},yt={class:"col-span-12"},St={key:0,class:"fixed top-0 w-full h-full left-0 flex items-center justifty-center bg-black bg-opacity-30 z-[999999]"},wt={__name:"edit",setup(D){const i=l({count_name:"",count_date:"",notes:""}),m=l(!1),o=I(new P),n=l(new Date().toISOString().split("T")[0]);return T(()=>{i.value.count_date=n.value}),(f,c)=>(y(),$(Q,null,[s("div",dt,[r(u(tt),{to:"/inventory/stock-count"},{default:_(()=>[r(u(b),{variant:"primary",size:"sm",class:"shadow-md mr-4 h-8 w-9"},{default:_(()=>[r(u(W),{icon:"ChevronLeft",class:"w-5 h-5"})]),_:1})]),_:1}),s("h2",mt,k(f.$t("stock-count.headingEdit")),1)]),s("div",ft,[s("div",pt,[s("div",_t,[s("div",vt,[s("div",kt,[r(u(E),null,{default:_(()=>[S(k(f.$t("stock-count.countName"))+" ",1),c[3]||(c[3]=s("span",{class:"text-danger"}," *",-1))]),_:1}),r(u(et),{modelValue:i.value.count_name,"onUpdate:modelValue":c[0]||(c[0]=d=>i.value.count_name=d),id:"count_name",type:"text",placeholder:f.$t("stock-count.countName")},null,8,["modelValue","placeholder"])]),c[4]||(c[4]=s("div",{class:"col-span-6"},null,-1)),s("div",gt,[r(u(E),null,{default:_(()=>[S(k(f.$t("stock-count.notes")),1)]),_:1}),r(u(ot),{modelValue:i.value.notes,"onUpdate:modelValue":c[1]||(c[1]=d=>i.value.notes=d),class:"py-2 pl-4 resize-none",rows:3,placeholder:"Notes"},null,8,["modelValue"])]),s("div",yt,[r(it,{createStockCountForm:i.value,form:o,isloading:m.value,onUpdateLoading:c[2]||(c[2]=d=>m.value=d)},null,8,["createStockCountForm","form","isloading"])])])])])]),m.value?(y(),$("div",St,[r(at,{class:"absolute flex items-center justify-center w-full h-full top-0",margin:"0px",loading:!0,color:"#fff",size:"50px"})])):B("",!0)],64))}};export{wt as default};
