import{d as U,Q as B,r as i,R as E,U as H,A as L,V as N,o as _,c as d,a as r,t as j,n as S,b as c,u,g as T,f as z,F as q,h as P,w as $,Z as J,$ as Q,Y as W,W as Y}from"./index-Do1w1vvF.js";const Z={class:"flex justify-between mb-6"},G={class:"text-lg font-semibold text-gray-800"},K={class:"relative w-56 text-slate-500"},O={key:0},X={class:"mt-2"},ee={key:1},te={class:"flex gap-2.5"},se=U({__name:"index",props:{start_date:{type:String,required:!0},end_date:{type:String,required:!0},fullHeight:{type:Boolean,default:!0}},setup(y){const x=B().getUserId,p=i(!1),w=i(0),g=i([]);i(null);const e=E({current_page:1,pagesize:10,search:"",column_filters:[],sort_column:"id",sort_direction:"asc"}),{t:m}=H(),V=[{field:"customer_name",title:m("reporting.CustomerName")},{field:"phone",title:m("reporting.phone")},{field:"purchase_total",title:m("reporting.purchasetotal")},{field:"actions",title:m("dashboard.actions"),sort:!1}],k=[1,2,3,4,5,6,7,8,9];let h,b;const A=()=>{clearTimeout(b),b=setTimeout(()=>{f()},300)},D=(t,l)=>{if(!Array.isArray(t))return console.error("Rows is not a valid array."),{data:[],meta:{current_page:l.current_page||1,per_page:l.pagesize||10,first_page:1,last_page:1,total_pages:1,total:0}};const o=t.length,a=Math.max(1,l.current_page),s=Math.max(1,l.pagesize),n=(a-1)*s,I=n+s,M=t.slice(n,I),C=Math.ceil(o/s);return{data:M,meta:{current_page:a,per_page:s,first_page:1,last_page:C,total_pages:C,total:o}}},f=async()=>{try{h&&h.abort(),h=new AbortController,p.value=!0;const t=await Y.get("https://reporting.jaldi.app/api/v1/reporting/customer-purchase-history",{params:{...e,user_id:x}}),l=t.data;console.log(t.data);let o=l;if(e.search){const s=e.search.toLowerCase();o=o.filter(n=>` ${n.purchase_total} ${n.customer_name} ${n.phone}`.toLowerCase().includes(s))}e.sort_column&&o.sort((s,n)=>e.sort_direction==="asc"?s[e.sort_column]>n[e.sort_column]?1:-1:s[e.sort_column]<n[e.sort_column]?1:-1);const a=D(o,e);g.value=a.data.map(s=>({...s,customer_name:s.customer_name})),w.value=a.meta.total}catch{}p.value=!1},F=t=>{console.log("data",t),e.current_page=t.current_page,e.pagesize=t.pagesize,e.column_filters=t.column_filters,e.search=t.search,e.sort_column=t.sort_column,e.sort_direction=t.sort_direction,t.change_type==="search"?A():f()},v=i("en");return L(()=>{f(),v.value=localStorage.getItem("locale")||"en"}),N(),(t,l)=>{var o;return _(),d("div",{class:S(["p-5 box",{"h-full":y.fullHeight}])},[r("div",Z,[r("div",null,[r("h4",G,j(t.$t("reporting.CustomerPurchaseHistory")),1)]),r("div",{class:S(["flex items-center sm:mt-0",{"mr-auto":v.value==="ar","ml-auto":v.value!=="ar"}])},[r("div",K,[c(u(T),{modelValue:e.search,"onUpdate:modelValue":l[0]||(l[0]=a=>e.search=a),type:"text",class:"w-56 pr-10 !box",placeholder:"Search..."},null,8,["modelValue"]),c(u(z),{icon:"Search",class:"absolute inset-y-0 right-0 w-4 h-4 my-auto mr-3"})])],2)]),p.value?(_(),d("div",O,[r("div",X,[r("div",null,[r("ul",null,[(_(),d(q,null,P(k,a=>r("li",{class:"flex justify-between py-2 mb-1.5 border animate-pulse h-10 bg-slate-200 border-[#EFF0F4] w-full rounded-lg",key:a})),64))])])])])):((o=g.value)==null?void 0:o.length)>0?(_(),d("div",ee,[c(u(Q),{rows:g.value,columns:V,loading:p.value,totalRows:w.value,isServerMode:!0,pageSize:e.pagesize,sortable:!0,sortColumn:e.sort_column,sortDirection:e.sort_direction,search:e.search,onChange:F},{actions:$(a=>[r("div",te,[c(u(J),{to:`/inventory/products/${a.value.id}/edit`,class:"bg-[#96837f33] p-2 rounded-md cursor-pointer"},{default:$(()=>[c(u(z),{icon:"Eye",class:"w-4 h-4 text-gray-600"})]),_:2},1032,["to"])])]),_:1},8,["rows","loading","totalRows","pageSize","sortColumn","sortDirection","search"])])):W("",!0)],2)}}}),ae={class:"px-6 max-w-7xl mx-auto"},re={__name:"CustomerPurchaseHistoryReport",setup(y){return(R,x)=>(_(),d("div",ae,[c(se,{"full-height":!1,start_date:null,end_date:null})]))}};export{re as default};
