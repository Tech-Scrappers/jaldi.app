import{Q as ne,r as b,A as K,a6 as Q,a7 as ce,R as ie,c as u,a,b as l,w as c,u as d,n as f,t as r,a8 as ue,Y as h,F as E,h as W,X as pe,a9 as me,a2 as A,a3 as D,aa as ve,a5 as F,x as N,a4 as H,ab as _e,o as p,_ as C,f as w,Z as ge,e as m,I as y,g as V,ac as fe,J as he,a1 as G,ad as ye}from"./index-Do1w1vvF.js";import{_ as be}from"./index-qisK-D0y.js";import{_ as Ve}from"./Dropzone.vue_vue_type_script_setup_true_lang-icQa-NwA.js";import"./dropzone-DWIWGpu4.js";const $e={class:"flex items-center mt-8 intro-y"},ke={class:"grid grid-cols-12 gap-6 mt-5"},xe={class:"col-span-12 intro-y lg:col-span-12"},we={class:"intro-y box p-8"},Se={class:"grid grid-cols-12 gap-6"},Ce={class:"col-span-6"},Pe={key:0,class:"mt-2 text-xs text-red-600"},qe={class:"col-span-6"},Ue={key:0,class:"mt-2 text-xs text-red-600"},ze={class:"col-span-6"},Ee={key:0,class:"mt-2 text-xs text-red-600"},Be={class:"col-span-6"},Re={key:0,class:"mt-2 text-xs text-red-600"},Ae={class:"col-span-6"},De={class:"pt-7"},Fe={class:"col-span-12"},Ne={class:"grid grid-cols-12 gap-6 mt-5 relative z-10"},Ie={class:"col-span-12 intro-y lg:col-span-12"},Me={class:"intro-y box p-8"},Te={class:"grid grid-cols-12 gap-6"},je={class:"col-span-12"},Le={class:"mr-auto text-lg font-medium -mb-1"},Oe={class:"flex justify-center py-8"},Ke={class:"text-lg font-medium"},Qe={class:"col-span-12 -mt-4"},We={key:0,class:"mt-2 text-xs text-red-600 font-medium"},He={class:"grid grid-cols-12 gap-6 mt-5"},Ge={class:"col-span-12 intro-y lg:col-span-12"},Je={class:"intro-y box p-8"},Xe={class:"grid grid-cols-12 gap-6"},Ye={class:"col-span-12"},Ze={class:"mr-auto text-lg font-medium -mb-1"},ea={class:"col-span-12"},aa={class:"gap-5"},ta={class:"grid grid-cols-12 gap-6"},sa={class:"col-span-3"},oa={key:0,class:"mt-2 text-xs text-red-600"},la={class:"col-span-3"},da={key:0,class:"mt-2 text-xs text-red-600"},ra={class:"col-span-3"},na={key:0,class:"mt-2 text-xs text-red-600"},ca={class:"col-span-3"},ia={class:"flex items-center z-40"},ua=["value"],pa={key:0,class:"mt-2 text-xs text-red-600"},ma={class:"grid grid-cols-12 gap-6 mt-5 relative z-[10]"},va={class:"col-span-12 intro-y lg:col-span-12"},_a={class:"intro-y box p-8"},ga={class:"grid grid-cols-12 gap-6"},fa={class:"col-span-12"},ha={class:"mr-auto text-lg font-medium -mb-1"},ya={class:"col-span-12"},ba={class:"gap-5"},Va={key:0,class:"sm:col-span-3 md:col-span-3 lg:col-span-2"},$a={key:1,class:"sm:col-span-3 md:col-span-3 lg:col-span-2"},ka={class:"sm:col-span-3 md:col-span-3 lg:col-span-2 relative"},xa={key:0,class:"mt-1 absolute text-xs text-red-600"},wa={class:"sm:col-span-3 md:col-span-3 lg:col-span-2"},Sa={class:"sm:col-span-3 md:col-span-3 lg:col-span-2"},Ca={key:1,class:"flex ml-2 gap-2 items-center mt-7"},Pa={class:""},qa={class:"col-span-12"},Ua={class:"ml-4 mr-4"},za={class:"font-medium"},Ea={class:"ml-4 mr-4"},Ba={class:"font-medium"},Ra={class:"mt-1 text-slate-500"},Aa={key:0,class:"fixed top-0 w-full h-full left-0 flex items-center justify-center bg-black bg-opacity-30 z-[999999]"},ja={__name:"create",setup(Da){const J=ne().getUserId,X=b(null),I=pe(),P=b(""),M=e=>{X.value=e,P.value=e,console.log("Scanned Barcode:",e)},Y=()=>{P.value?console.log("Searching for barcode:",P.value):console.warn("No barcode entered to search.")},Z=()=>{P.value=""};K(()=>{Q.on("barcode-scanned",M),barcode.value=I.query.barcode,t.value.barcode=I.query.barcode}),ce(()=>{Q.off("barcode-scanned",M)});const t=b({user_id:J,brand_id:"",category_id:"",sub_category_id:"",SubCategorySelect:"",sku:"",image:"",name_ar:"",name_en:"",barcode:"",description:"",initial_quantity:"",cost_price:"",sale_price:"",vat:1,packings:[],is_imported:1}),ee=[{value:1,label:"Subject to VAT"},{value:0,label:"Not subject to VAT"}],n=ie(new me),ae=async()=>{const e=t.value.category_id,o=t.value.SubCategorySelect;console.log("originalCategoryId",e),console.log("originalSubCategorySelect",o);try{const s=t.value.packings.map(_=>{const q=_.name==="Custom"&&!_.label&&!_.barcode&&_.qty<=0,U=(_.name==="Carton"||_.name==="Outer")&&!_.barcode&&_.qty<=0;if(q||U)return!1;if((_.name==="Carton"||_.name==="Outer")&&_.label===""){const{label:R,...S}=_;return S}return _}).filter(Boolean);t.value.packings=s,t.value.category_id=t.value.category_id,t.value.sub_category_id=t.value.SubCategorySelect,console.log("createFormData.value.category_id",t.value.category_id);const g=await A.product.create(t.value),v=D(g);console.log("result",v),v.success&&ve.push("/inventory/products")}catch(s){t.value.category_id=e,t.value.SubCategorySelect=o,F(s),console.log("error",s),n.setErrors(s.errors),console.log("createFormData.value.category_id error",t.value.category_id),console.log("createFormData.value.SubCategorySelect error",t.value.SubCategorySelect)}},k=b(!1),$=b([]),T=async()=>{try{const e=await A.packings.list(),o=D(e);o.success&&($.value=o.data.data.map(s=>({id:s.id,name:s.name||"",label:s.label||"",barcode:s.barcode||"",qty:s.quantity||0,sale_price:s.sale_price||0,vat:s.vat||15,isCustom:!1})),t.value.packings=[...$.value])}catch(e){F(e)}},j=b(!1),te=()=>{const e={id:$.value[2].id,name:$.value[2].name,label:"",barcode:"",qty:0,sale_price:0,vat:15,isCustom:!0};$.value.push(e),t.value.packings=[...$.value],j.value=!0},B=b(),se=e=>{$.value.length>2&&($.value.splice(e,1),t.value.packings=[...$.value])};b(!0);const oe=()=>{t.value.sku=Math.floor(1e10+Math.random()*9e10).toString()},x=b("en");K(()=>{x.value=localStorage.getItem("locale")||"en",T();const e=L.value;e&&(e.dropzone.on("addedfile",o=>{t.value.image=o}),e.dropzone.on("removedfile",()=>{t.value.image=""}))});const le=b(),L=b(),de=b();N("bind[dropzoneSingleRef]",e=>{le.value=e}),N("bind[dropzoneMultipleRef]",e=>{L.value=e}),N("bind[dropzoneValidationRef]",e=>{de.value=e});const re=async e=>{var o,s,g,v,_,q,U,R;if(t.value.barcode!=="")try{k.value=!0,e=t.value.barcode,console.log("barcodeId",e);const S=await A.product.search(e),z=D(S);if(z.success){if(((s=(o=z.data)==null?void 0:o.data)==null?void 0:s.length)>0){k.value=!1;const i=document.querySelectorAll("#success-notification-content")[0].cloneNode(!0);i.classList.remove("hidden"),H({node:i,duration:3e3,newWindow:!0,close:!0,gravity:"top",position:"right",stopOnFocus:!0}).showToast()}if(((v=(g=z.data)==null?void 0:g.data)==null?void 0:v.length)===0)if(e){k.value=!0;const i=await _e.get(`https://product-bank.jaldi.app/api/search-products?barcode=[${e}]`);if(console.log("productBankResponse",i),i.status===200){if(k.value=!1,((q=(_=i.data)==null?void 0:_.data)==null?void 0:q.length)===0){k.value=!1,t.value.is_imported=0;const O=document.querySelectorAll("#success-notification-productBank")[0].cloneNode(!0);O.classList.remove("hidden"),H({node:O,duration:3e3,newWindow:!0,close:!0,gravity:"top",position:"right",stopOnFocus:!0}).showToast()}((R=(U=i.data)==null?void 0:U.data)==null?void 0:R.length)>0&&(B.value=i.data.data[0],console.log("isProductBankData",B),t.value.name_ar=i.data.data[0].name_ar,t.value.name_en=i.data.data[0].name_en,t.value.packings[0].barcode=i.data.data[0].packings[0].barcode,t.value.packings[0].qty=i.data.data[0].packings[0].qty,t.value.description=i.data.data[0].description,t.value.initial_quantity=i.data.data[0].initial_quantity,t.value.cost_price=i.data.data[0].cost_price,t.value.sale_price=i.data.data[0].sale_price,t.value.packings=i.data.data[0].packings,t.value.brand_id=i.data.data[0].brand.id,t.value.image=i.data.data[0].image,t.value.packings[1].barcode=i.data.data[0].packings[1].barcode,t.value.packings[1].qty=i.data.data[0].packings[1].qty),$.value.length==0&&T()}}else console.error("No barcode found for fallback API call.");else z.success}}catch(S){F(S),k.value=!1}};return(e,o)=>(p(),u(E,null,[a("div",$e,[l(d(ge),{to:"/inventory/products"},{default:c(()=>[l(d(C),{variant:"primary",size:"sm",class:f(["shadow-md h-8 w-9",{"ml-4":x.value==="ar","mr-4":x.value!=="ar"}])},{default:c(()=>[l(d(w),{icon:"ChevronLeft",class:f(["w-5 h-5",{"rotate-180":x.value==="ar","":x.value!=="ar"}])},null,8,["class"])]),_:1},8,["class"])]),_:1}),a("h2",{class:f(["text-lg font-semibold",{"ml-auto":x.value==="ar","mr-auto":x.value!=="ar"}])},r(e.$t("product.addNewProduct")),3)]),a("div",ke,[a("div",xe,[a("div",we,[a("div",Se,[a("div",Ce,[l(d(y),{for:"barcode"},{default:c(()=>[m(r(e.$t("product.barcode"))+" ",1),o[9]||(o[9]=a("span",{class:"text-danger"}," *",-1))]),_:1}),l(d(V),{id:"barcode",modelValue:t.value.barcode,"onUpdate:modelValue":o[0]||(o[0]=s=>t.value.barcode=s),onChange:re,type:"text",placeholder:e.$t("product.scanOrEnterBarcode"),onKeydown:ue(Y,["enter"]),onFocus:Z,class:f({"border-red-500":n.invalid("barcode")})},null,8,["modelValue","placeholder","class"]),n.invalid("barcode")?(p(),u("div",Pe,r(n.getError("barcode")),1)):h("",!0)]),o[13]||(o[13]=a("div",{class:"col-span-6"},null,-1)),a("div",qe,[l(d(y),{for:"name_en"},{default:c(()=>[m(r(e.$t("product.productNameEn"))+" ",1),o[10]||(o[10]=a("span",{class:"text-danger"}," *",-1))]),_:1}),l(d(V),{modelValue:t.value.name_en,"onUpdate:modelValue":o[1]||(o[1]=s=>t.value.name_en=s),id:"name_en",type:"text",placeholder:e.$t("product.productNameEn"),class:f({"border-red-500":n.invalid("name_en")})},null,8,["modelValue","placeholder","class"]),n.invalid("name_en")?(p(),u("div",Ue,r(n.getError("name_en")),1)):h("",!0)]),a("div",ze,[l(d(y),{for:"nameAr"},{default:c(()=>[m(r(e.$t("product.productNameAr"))+" ",1),o[11]||(o[11]=a("span",{class:"text-danger"}," *",-1))]),_:1}),l(d(V),{id:"nameAr",modelValue:t.value.name_ar,"onUpdate:modelValue":o[2]||(o[2]=s=>t.value.name_ar=s),type:"text",placeholder:e.$t("product.productNameAr"),class:f({"border-red-500":n.invalid("name_ar")})},null,8,["modelValue","placeholder","class"]),n.invalid("name_ar")?(p(),u("div",Ee,r(n.getError("name_ar")),1)):h("",!0)]),a("div",Be,[l(d(y),null,{default:c(()=>[m(r(e.$t("product.sku"))+" ",1),o[12]||(o[12]=a("span",{class:"text-danger"}," *",-1))]),_:1}),l(d(V),{modelValue:t.value.sku,"onUpdate:modelValue":o[3]||(o[3]=s=>t.value.sku=s),id:"sku",type:"text",placeholder:e.$t("product.sku"),class:f({"border-red-500":n.invalid("sku")})},null,8,["modelValue","placeholder","class"]),n.invalid("sku")?(p(),u("div",Re,r(n.getError("sku")),1)):h("",!0)]),a("div",Ae,[a("div",De,[l(d(C),{variant:"primary",class:"mr-2 py-2 shadow-md w-[180px]",onClick:oe},{default:c(()=>[m(r(e.$t("product.autoGenerateSku")),1)]),_:1})])]),a("div",Fe,[l(d(y),null,{default:c(()=>[m(r(e.$t("product.description")),1)]),_:1}),l(d(fe),{modelValue:t.value.description,"onUpdate:modelValue":o[4]||(o[4]=s=>t.value.description=s),class:"py-2 pl-4 resize-none",rows:3,placeholder:e.$t("product.descriptionPlaceholder")},null,8,["modelValue","placeholder"])])])])])]),l(be,{createFormData:t.value,isProductBankData:B.value,form:n},null,8,["createFormData","isProductBankData","form"]),a("div",Ne,[a("div",Ie,[a("div",Me,[a("div",Te,[a("div",je,[a("h3",Le,r(e.$t("product.uploadImage")),1)]),a("div",{class:f(["col-span-12 upload-img",{"border-upload":n.invalid("image")}])},[l(d(Ve),{refKey:"dropzoneMultipleRef",options:{url:"https://httpbin.org/post",autoProcessQueue:!1,thumbnailWidth:150,maxFilesize:100,acceptedFiles:"image/jpeg,image/png,image/jpg",headers:{"My-Awesome-Header":"header value"},addRemoveLinks:!0},class:"dropzone"},{default:c(()=>[a("div",Oe,[l(d(w),{icon:"Upload",class:"w-10 h-10"})]),a("div",Ke,r(e.$t("product.dropFilesHere")),1)]),_:1})],2),a("div",Qe,[n.invalid("image")?(p(),u("div",We,r(e.$t("product.imageUploadError")),1)):h("",!0)])])])])]),a("div",He,[a("div",Ge,[a("div",Je,[a("div",Xe,[a("div",Ye,[a("h3",Ze,r(e.$t("product.stockPricingDetails")),1)]),a("div",ea,[a("div",aa,[a("div",ta,[a("div",sa,[l(d(y),null,{default:c(()=>[m(r(e.$t("product.initialQuantity")),1)]),_:1}),l(d(V),{min:"0",modelValue:t.value.initial_quantity,"onUpdate:modelValue":o[5]||(o[5]=s=>t.value.initial_quantity=s),type:"text",placeholder:"0",class:f({"border-red-500":n.invalid("initial_quantity")})},null,8,["modelValue","class"]),n.invalid("initial_quantity")?(p(),u("div",oa,r(n.getError("initial_quantity")),1)):h("",!0)]),a("div",la,[l(d(y),{for:"cost_price"},{default:c(()=>[m(r(e.$t("product.costPrice"))+" ",1),o[14]||(o[14]=a("span",{class:"text-danger"}," *",-1))]),_:1}),l(d(V),{id:"cost_price",modelValue:t.value.cost_price,"onUpdate:modelValue":o[6]||(o[6]=s=>t.value.cost_price=s),type:"text",placeholder:"0.00",class:f({"border-red-500":n.invalid("cost_price")})},null,8,["modelValue","class"]),n.invalid("cost_price")?(p(),u("div",da,r(n.getError("cost_price")),1)):h("",!0)]),a("div",ra,[l(d(y),{id:"sale_price"},{default:c(()=>[m(r(e.$t("product.salePrice"))+" ",1),o[15]||(o[15]=a("span",{class:"text-danger"}," *",-1))]),_:1}),l(d(V),{id:"sale_price",modelValue:t.value.sale_price,"onUpdate:modelValue":o[7]||(o[7]=s=>t.value.sale_price=s),type:"number",placeholder:"0.00",class:f({"border-red-500":n.invalid("sale_price")})},null,8,["modelValue","class"]),n.invalid("sale_price")?(p(),u("div",na,r(n.getError("sale_price")),1)):h("",!0)]),a("div",ca,[l(d(y),{for:"vat"},{default:c(()=>[m(r(e.$t("product.vat"))+" ",1),o[16]||(o[16]=a("span",{class:"text-danger"}," *",-1))]),_:1}),a("div",ia,[l(d(he),{modelValue:t.value.vat,"onUpdate:modelValue":o[8]||(o[8]=s=>t.value.vat=s),options:{placeholder:e.$t("product.vat")},class:f(["w-full",{"border-red-500":n.invalid("vat")}]),id:"vat"},{default:c(()=>[(p(),u(E,null,W(ee,s=>a("option",{value:s.value},r(s.label),9,ua)),64))]),_:1},8,["modelValue","options","class"])]),n.invalid("vat")?(p(),u("div",pa,r(n.getError("vat")),1)):h("",!0)])]),o[17]||(o[17]=a("div",{class:"py-2"},null,-1))])])])])])]),a("div",ma,[a("div",va,[a("div",_a,[a("div",ga,[a("div",fa,[a("h3",ha,r(e.$t("product.packings")),1)]),a("div",ya,[a("div",ba,[(p(!0),u(E,null,W($.value,(s,g)=>(p(),u("div",{key:g,class:f({"new-packing-class":j.value})},[a("div",{class:f(`pb-6 grid grid-cols-12 gap-2  items-center hi${g}`)},[g!==2?(p(),u(E,{key:0},[g<2?(p(),u("div",Va,[l(d(y),{class:"text-[13px]"},{default:c(()=>[m(r(e.$t("product.packingType")),1)]),_:1}),l(d(V),{modelValue:s.name,"onUpdate:modelValue":v=>s.name=v,type:"text",placeholder:e.$t("product.packingTypePlaceholder"),disabled:""},null,8,["modelValue","onUpdate:modelValue","placeholder"])])):h("",!0),g>1?(p(),u("div",$a,[l(d(y),{class:"text-[13px]"},{default:c(()=>[m(r(e.$t("product.label")),1)]),_:1}),l(d(V),{modelValue:s.label,"onUpdate:modelValue":v=>s.label=v,type:"text",placeholder:e.$t("product.labelPlaceholder")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])):h("",!0),a("div",ka,[l(d(y),{class:"text-[13px]"},{default:c(()=>[m(r(e.$t("product.barcode")),1)]),_:1}),l(d(V),{modelValue:s.barcode,"onUpdate:modelValue":v=>s.barcode=v,type:"text",placeholder:e.$t("product.barcode"),class:f({"border-red-500":n.invalid(`packings.${g}.barcode`)})},null,8,["modelValue","onUpdate:modelValue","placeholder","class"]),n.invalid(`packings.${g}.barcode`)?(p(),u("div",xa,r(e.$t("product.barcodeError")),1)):h("",!0)]),a("div",wa,[l(d(y),{class:"capitalize text-[13px]"},{default:c(()=>[m(r(g>1?e.$t("product.piecesInPacking"):`${e.$t("product.quantityIn")} ${s.name}`),1)]),_:2},1024),l(d(V),{modelValue:s.qty,"onUpdate:modelValue":v=>s.qty=v,type:"number",placeholder:e.$t("product.quantity")},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),a("div",Sa,[l(d(y),{class:"text-[13px]"},{default:c(()=>[m(r(e.$t("product.salePrice")),1)]),_:1}),l(d(V),{modelValue:s.sale_price,"onUpdate:modelValue":v=>s.sale_price=v,type:"number",placeholder:e.$t("product.salePrice")},null,8,["modelValue","onUpdate:modelValue","placeholder"])])],64)):h("",!0),g>2?(p(),u("div",Ca,[l(d(C),{variant:"danger",class:"shadow-md flex items-center",onClick:v=>se(g)},{default:c(()=>[l(d(w),{icon:"Trash",class:"w-5 h-5"})]),_:2},1032,["onClick"])])):h("",!0)],2)],2))),128)),a("div",Pa,[l(d(C),{variant:"primary",class:"shadow-md flex items-center",onClick:te},{default:c(()=>[l(d(w),{icon:"Plus",class:"w-5 h-5"}),m(" "+r(e.$t("product.addCustomPacking")),1)]),_:1})])])]),a("div",qa,[l(d(C),{variant:"primary",class:"mr-2 mt-2 shadow-md",onClick:ae},{default:c(()=>[m(r(e.$t("product.submit")),1)]),_:1})])])])])]),l(d(G),{id:"success-notification-content",class:"flex hidden"},{default:c(()=>[l(d(w),{icon:"CheckCircle",class:"text-success"}),a("div",Ua,[a("div",za,r(e.$t("product.productAlreadyAdded")),1)])]),_:1}),l(d(G),{id:"success-notification-productBank",class:"flex hidden"},{default:c(()=>[l(d(w),{icon:"CheckCircle",class:"text-success"}),a("div",Ea,[a("div",Ba,r(e.$t("product.noProduct")),1),a("div",Ra,r(e.$t("product.addProductManually")),1)])]),_:1}),k.value?(p(),u("div",Aa,[l(ye,{class:"absolute flex items-center justify-center w-full h-full top-0",margin:"0px",loading:!0,color:"#fff",size:"50px"})])):h("",!0)],64))}};export{ja as default};
