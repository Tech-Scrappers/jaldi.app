import{ai as P,r as l,p as k,R as q,a9 as E,o as _,c as g,a as s,b as c,i as R,Y as h,w as p,e as y,t as m,u as o,_ as S,an as j,ao as A,ap as L,aq as O,ar as U,a2 as w,a3 as b,ag as $,ah as N,U as M,A as Y,n as V,F as Z,f as G,Z as H,I as D,g as J,ac as K,ad as Q}from"./index-Do1w1vvF.js";import{S as W,a as X}from"./StockCountList-D1VJtoZU.js";const tt={class:"grid grid-cols-12 gap-6"},et={class:"col-span-12"},ot={class:"intro-y box p-4 rounded-lg"},st={class:"col-span-12 text-right mt-4"},at={__name:"StockCountComponent",props:{createStockCountForm:{type:Object,required:!0},form:{type:Object,required:!0}},setup(F){const d=P(),t=F,a=l([]),u=l(0),C=l(0),x=l("percent"),r=l(new Set);l(!0);const f=k(()=>j(a.value));k(()=>A(a.value)),k(()=>L(a.value)),k(()=>O(x.value,u.value,C.value,f.value)),k(()=>U(a.value)),l(!1),l(!1),q(new E);function I(e){if(r.value.has(e.id)){alert("This product is already in the invoice.");return}a.value.push({...e,expected:1,counted:0,difference:0,cost:2}),r.value.add(e.id)}function T(e){const i=a.value[e];i!=null&&i.id&&r.value.delete(i.id),a.value.splice(e,1)}const z=async()=>{try{t.createStockCountForm.isloading=!0;const e={count_name:t.createStockCountForm.count_name,count_date:t.createStockCountForm.count_date,notes:t.createStockCountForm.notes,products:a.value.map(n=>({product_id:n.id,expected:n.initial_quantity,counted:n.counted,difference:Number(n.initial_quantity-n.counted),cost:n.cost_price}))};console.log("count stock payload",e);const i=await w.stockCount.create(e),v=b(i);v.success&&(console.log("count stockresponse.status",v),t.createStockCountForm.isloading=!1,d.push("/inventory/stock-count"))}catch(e){console.log("error.response.data.errors",e),t.form.setErrors(e),$().fry(N.StockCount.error(e.message)),t.form.setErrors(e.errors)}finally{t.createStockCountForm.isloading=!1}},B=async()=>{try{t.createStockCountForm.isloading=!0;const e={count_name:t.createStockCountForm.count_name,count_date:t.createStockCountForm.count_date,notes:t.createStockCountForm.notes,is_draft:1,products:a.value.map(n=>({product_id:n.id,expected:n.initial_quantity,counted:n.counted,difference:Number(n.initial_quantity-n.counted),cost:n.cost_price}))};console.log("count stock payload",e);const i=await w.stockCount.create(e),v=b(i);v.success&&(console.log("count stockresponse.status",v),t.createStockCountForm.isloading=!1,d.push("/inventory/stock-count"))}catch(e){console.log("error.response.data.errors",e),$().fry(N.StockCount.error(e.message)),t.form.setErrors(e.errors)}finally{t.createStockCountForm.isloading=!1}};return(e,i)=>(_(),g("div",null,[s("div",tt,[s("div",et,[s("div",ot,[c(W,{"added-product-ids":r.value,onAddProduct:I,createStockCountForm:t.createStockCountForm,form:t.form},null,8,["added-product-ids","createStockCountForm","form"]),a.value.length>0?(_(),R(X,{key:0,products:a.value,createStockCountForm:t.createStockCountForm,onRemoveProduct:T},null,8,["products","createStockCountForm"])):h("",!0)])])]),s("div",st,[c(o(S),{variant:"primary",onClick:B,class:"mr-2 mt-2 shadow-md"},{default:p(()=>[y(m(e.$t("stock-count.saveDraft")),1)]),_:1}),c(o(S),{variant:"primary",onClick:z,class:"mr-2 mt-2 shadow-md"},{default:p(()=>[y(m(e.$t("stock-count.createNewButton")),1)]),_:1})])]))}},nt={class:"flex items-center mt-8 intro-y"},ct={class:"mr-auto text-lg font-medium"},rt={class:"grid grid-cols-12 gap-6 mt-5"},lt={class:"col-span-12 intro-y lg:col-span-12"},ut={class:"intro-y box p-8"},it={class:"grid grid-cols-12 gap-6"},dt={class:"col-span-6"},mt={key:0,class:"mt-2 text-xs text-red-600"},_t={class:"col-span-12"},pt={key:0,class:"mt-2 text-xs text-red-600"},ft={class:"col-span-12"},vt={key:0,class:"fixed top-0 w-full h-full left-0 flex items-center justify-center bg-black bg-opacity-30 z-[999999]"},ht={__name:"create",setup(F){const{t:d}=M(),t=l({count_name:"",count_date:"",notes:""}),a=l(!1),u=q(new E),C=l(new Date().toISOString().split("T")[0]);return Y(()=>{t.value.count_date=C.value}),(x,r)=>(_(),g(Z,null,[s("div",nt,[c(o(H),{to:"/inventory/stock-count"},{default:p(()=>[c(o(S),{variant:"primary",size:"sm",class:"shadow-md mr-4 h-8 w-9"},{default:p(()=>[c(o(G),{icon:"ChevronLeft",class:"w-5 h-5"})]),_:1})]),_:1}),s("h2",ct,m(o(d)("stock-count.createNew")),1)]),s("div",rt,[s("div",lt,[s("div",ut,[s("div",it,[s("div",dt,[c(o(D),null,{default:p(()=>[y(m(o(d)("stock-count.countName"))+" ",1),r[2]||(r[2]=s("span",{class:"text-danger"},"*",-1))]),_:1}),c(o(J),{modelValue:t.value.count_name,"onUpdate:modelValue":r[0]||(r[0]=f=>t.value.count_name=f),id:"count_name",type:"text",placeholder:o(d)("stock-count.countName"),class:V({"border-red-500":u.invalid("count_name")})},null,8,["modelValue","placeholder","class"]),u.invalid("count_name")?(_(),g("div",mt,m(u.getError("count_name")),1)):h("",!0)]),s("div",_t,[c(o(D),null,{default:p(()=>[y(m(o(d)("stock-count.notes")),1)]),_:1}),c(o(K),{modelValue:t.value.notes,"onUpdate:modelValue":r[1]||(r[1]=f=>t.value.notes=f),class:V(["py-2 pl-4 resize-none",{"border-red-500":u.invalid("notes")}]),rows:3,placeholder:o(d)("stock-count.notes")},null,8,["modelValue","placeholder","class"]),u.invalid("notes")?(_(),g("div",pt,m(u.getError("notes")),1)):h("",!0)]),s("div",ft,[c(at,{createStockCountForm:t.value,form:u},null,8,["createStockCountForm","form"])])])])])]),a.value?(_(),g("div",vt,[c(Q,{class:"absolute flex items-center justify-center w-full h-full top-0",margin:"0px",loading:!0,color:"#fff",size:"50px"})])):h("",!0)],64))}};export{ht as default};
