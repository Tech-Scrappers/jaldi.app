import{r as h,o as l,c as d,a as e,e as C,t as o,b as i,n as k,g as q,i as F,u as c,al as D,Y as v,w as b,F as S,h as E,am as O,a2 as M,a3 as P,Q as J,R,A as W,W as z,ag as Y,ah as Z,a9 as G,aa as H,_ as A,f as T,Z as K,I as B,ac as X,J as tt,ad as et}from"./index-iXE1tgq1.js";const st={class:"mb-4"},at={for:"productSearch",class:"block text-gray-700 font-medium mb-2"},ot={class:"relative"},nt={class:"absolute top-4 right-5"},lt={key:0,class:"relative"},dt={class:"mt-1 bg-white box rounded-t-none z-[999]",key:"matched"},it=["onClick"],rt={class:"flex items-center"},ct={class:"text-sm mb-1"},ut={class:"mt-4",key:"none"},mt={class:"text-gray-500"},_t={__name:"SearchProduct",props:{addedProductIds:{type:Object,required:!0},invalid:{type:Boolean,default:!1}},emits:["add-product"],setup(U,{emit:N}){const w=N,p=U,y=h(""),r=h([]),x=h(!1),f=h(!1);async function L(){if(!y.value){r.value=[];return}f.value=!0;try{const u=await M.purchaseInvoice.allList(),a=P(u);a.success&&(x.value=!0,r.value=a.data.data.filter(m=>{var j,V,I;return(((j=m.name_en)==null?void 0:j.toLowerCase().includes(y.value.toLowerCase()))||((V=m.name_ar)==null?void 0:V.includes(y.value))||((I=m.barcode)==null?void 0:I.includes(y.value)))&&!p.addedProductIds.has(m.id)}))}catch(u){console.error("Error fetching products:",u),r.value=[]}finally{f.value=!1}}function $(u){y.value="",w("add-product",{...u,initial_quantity:u.initial_quantity,remove_qty:0,updated_quantity:u.initial_quantity,reason:null}),x.value=!1}return(u,a)=>(l(),d("div",st,[e("label",at,[C(o(u.$t("stock-adjustment.product"))+" ",1),a[1]||(a[1]=e("span",{class:"text-danger"}," *",-1))]),e("div",ot,[i(q,{type:"text",id:"productSearch",modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=m=>y.value=m),onInput:L,class:k({"border-red-500":U.invalid}),placeholder:u.$t("stock-adjustment.enterProductCodeOrName")},null,8,["modelValue","class","placeholder"]),e("span",nt,[f.value?(l(),F(c(D),{key:0,icon:"three-dots",class:"w-6 h-6 text-red-700"})):v("",!0)])]),i(O,{name:"fade",mode:"out-in"},{default:b(()=>[x.value?(l(),d("div",lt,[r.value.length&&y.value.length?(l(),d("div",dt,[e("ul",{class:k([{"h-[350px] overflow-y-scroll overflow-hidden":r.value.length>7},"absolute top-0 w-full bg-white shadow-md rounded-b-md z-[999]"])},[(l(!0),d(S,null,E(r.value,m=>(l(),d("li",{key:m.id,class:"border-t border-gray-200 py-2 px-3 hover:bg-[#f1f5f9]"},[e("div",{onClick:j=>$(m),class:"cursor-pointer font-medium text-sm flex justify-between items-center"},[e("div",rt,[e("div",null,[e("h4",ct,o(m.name_en),1)])])],8,it)]))),128))],2)])):y.value.length?(l(),d("div",ut,[e("p",mt,o(u.$t("stock-adjustment.noProductsMatched")),1)])):v("",!0)])):v("",!0)]),_:1})]))}},pt={class:"flex items-center mt-8 intro-y"},yt={class:"grid grid-cols-12 gap-6 mt-5"},vt={class:"col-span-12 intro-y lg:col-span-12"},ht={class:"intro-y box p-8"},ft={class:"grid grid-cols-12 gap-6"},gt={class:"col-span-6"},bt={class:"flex items-center flex-row-reverse"},kt={key:0,class:"mt-2 text-sm text-red-600"},xt={class:"col-span-12"},$t={key:0,class:"mt-2 text-sm text-red-600"},jt={class:"col-span-12"},qt={class:"grid grid-cols-12 gap-6"},wt={class:"col-span-12"},Vt={class:"intro-y box p-4 rounded-lg"},It={key:0,class:"mt-2 text-sm text-red-600"},Ct={class:"mt-8"},St={key:0,class:"w-full align-top text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400"},Pt={class:"bg-gray-100 border-b"},Ut={scope:"col",class:"px-6 py-3 text-gray-700 font-medium w-[350px]"},Lt={scope:"col",class:"px-6 py-3 text-gray-700 font-medium"},Et={scope:"col",class:"px-6 py-3 text-gray-700 font-medium"},Nt={scope:"col",class:"px-6 py-3 text-gray-700 font-medium"},Rt={scope:"col",class:"px-6 py-3 text-gray-700 font-medium"},zt={scope:"col",class:"px-4 py-3 text-gray-700 font-medium"},At={class:"py-3 px-4 align-top"},Tt={class:"py-3 px-4 align-top"},Bt={key:0,class:"mt-0.5 text-[10px] text-red-600"},Mt={class:"py-3 px-4 align-top"},Qt={class:"py-3 px-4 align-top"},Ft={class:"py-3 px-1 align-top"},Dt={class:""},Ot=["value"],Jt={key:0,class:"mt-0.5 text-[10px] text-red-600"},Wt={class:"py-3 px-2 align-top"},Yt=["onClick"],Zt={class:"col-span-12 text-right"},Gt={key:0,class:"fixed top-0 w-full h-full left-0 flex items-center justifty-center bg-black bg-opacity-30 z-[999999]"},Kt={__name:"create",setup(U){const w=J().getUserId,p=R({adjustment_name:"",notes:"",supplier_id:"",isloading:!1}),y=h(),r=h([]),x=h([]),f=h(new Set),L=async()=>{try{const t=await M.purchaseInvoice.allList(),s=P(t);s.success&&(y.value=s.data.data)}catch(t){console.log("result.data.data",t),Y().fry(Z.supplier.error(t.message))}},$=h("en");W(()=>{L(),j(),$.value=localStorage.getItem("locale")||"en"});function u(){return{count_name:p.adjustment_name,notes:p.notes||"",products:r.value.map(s=>({product_id:s.id,remove_quantity:s.remove_qty||0,available_quantity:s.initial_quantity,updated_quantity:s.updated_quantity,stock_adjustment_reason_id:s.stock_adjustment_reason_id||null}))}}const a=R(new G);async function m(){p.isloading=!0;const t=u();if(console.log(t),!!t)try{const s=await z.post(`stock-adjustments?user_id=${w}`,t);P(s).success&&H.push("/inventory/stock-adjustment")}catch(s){a.setErrors(s.errors)}finally{p.isloading=!1}}async function j(){try{const t=await z.get(`stock-adjustment-reason?user_id=${w}`),s=P(t);s.success&&(x.value=s.data.data)}catch(t){console.error("Error fetching reasons list:",t)}}function V(t){if(f.value.has(t.id)){alert("This product is already in the invoice.");return}r.value.push({...t,updated_quantity:t.initial_quantity,initial_quantity:t.initial_quantity,totalPrice:t.cost_price,stock_adjustment_reason_id:""}),f.value.add(t.id)}console.log(r.value);function I(t){const s=r.value[t];s!=null&&s.id&&f.value.delete(s.id),r.value.splice(t,1)}const Q=t=>{t.remove_qty>t.initial_quantity?t.remove_qty=t.initial_quantity:(t.remove_qty<0||t.remove_qty===null)&&(t.remove_qty=0),t.updated_quantity=t.initial_quantity-t.remove_qty};return(t,s)=>(l(),d(S,null,[e("div",pt,[i(c(K),{to:"/inventory/stock-adjustment"},{default:b(()=>[i(c(A),{variant:"primary",size:"sm",class:"shadow-md mr-4 h-8 w-9"},{default:b(()=>[i(c(T),{icon:"ChevronLeft",class:"w-5 h-5"})]),_:1})]),_:1}),e("h2",{class:k(["text-lg font-medium",{"ml-auto":$.value==="ar","mr-auto":$.value!=="ar"}])},o(t.$t("stock-adjustment.addStockAdjustment")),3)]),e("div",yt,[e("div",vt,[e("div",ht,[e("div",ft,[e("div",gt,[i(c(B),null,{default:b(()=>[C(o(t.$t("stock-adjustment.adjustmentName"))+" ",1),s[2]||(s[2]=e("span",{class:"text-danger"}," *",-1))]),_:1}),e("div",bt,[i(c(q),{modelValue:p.adjustment_name,"onUpdate:modelValue":s[0]||(s[0]=n=>p.adjustment_name=n),id:"supplier_number",type:"text",placeholder:t.$t("stock-adjustment.adjustmentName"),class:k(a.invalid("count_name")?"border-danger":"")},null,8,["modelValue","placeholder","class"])]),a.invalid("count_name")?(l(),d("div",kt,o(a.getError("count_name")),1)):v("",!0)]),e("div",xt,[i(c(B),{for:"supplier_number"},{default:b(()=>[C(o(t.$t("stock-adjustment.notes")),1)]),_:1}),i(c(X),{modelValue:p.notes,"onUpdate:modelValue":s[1]||(s[1]=n=>p.notes=n),placeholder:t.$t("stock-adjustment.notes"),rows:"4",class:k({"border-danger":a.invalid("notes")})},null,8,["modelValue","placeholder","class"]),a.invalid("notes")?(l(),d("div",$t,o(a.getError("notes")),1)):v("",!0)]),e("div",jt,[e("div",qt,[e("div",wt,[e("div",Vt,[i(_t,{invalid:a.invalid("products"),"added-product-ids":f.value,onAddProduct:V},null,8,["invalid","added-product-ids"]),a.invalid("products")?(l(),d("div",It,o(a.getError("products")),1)):v("",!0),e("div",Ct,[r.value.length>0?(l(),d("table",St,[e("thead",null,[e("tr",Pt,[e("th",Ut,o(t.$t("stock-adjustment.productName")),1),e("th",Lt,o(t.$t("stock-adjustment.removeQuantity")),1),e("th",Et,o(t.$t("stock-adjustment.availableQuantity")),1),e("th",Nt,o(t.$t("stock-adjustment.updatedQuantity")),1),e("th",Rt,o(t.$t("stock-adjustment.adjustmentReason")),1),e("th",zt,o(t.$t("stock-adjustment.actions")),1)])]),e("tbody",null,[(l(!0),d(S,null,E(r.value,(n,g)=>(l(),d("tr",{key:n.id||g,class:"odd:bg-white odd:dark:bg-gray-900 even:bg-gray-50 even:dark:bg-gray-800 border-b dark:border-gray-700"},[e("td",At,o(n.name_en),1),e("td",Tt,[i(c(q),{type:"number",modelValue:n.remove_qty,"onUpdate:modelValue":_=>n.remove_qty=_,modelModifiers:{number:!0},onInput:_=>Q(n),min:"0",readonly:n.initial_quantity<1,max:n.initial_quantity,class:k(["w-[85px] px-4 py-2 border rounded-lg",a.invalid(`products.${g}.remove_quantity`)?"border-danger":""])},null,8,["modelValue","onUpdate:modelValue","onInput","readonly","max","class"]),a.invalid(`products.${g}.remove_quantity`)?(l(),d("div",Bt,o(a.getError(`products.${g}.remove_quantity`)),1)):v("",!0)]),e("td",Mt,[i(c(q),{type:"number",readonly:"",modelValue:n.initial_quantity,"onUpdate:modelValue":_=>n.initial_quantity=_,modelModifiers:{number:!0},class:"w-[85px] px-4 py-2 border rounded-lg"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",Qt,[i(c(q),{type:"number",readonly:"",modelValue:n.updated_quantity,"onUpdate:modelValue":_=>n.updated_quantity=_,modelModifiers:{number:!0},class:"w-[85px] px-4 py-2 border rounded-lg"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",Ft,[e("div",Dt,[i(c(tt),{modelValue:n.stock_adjustment_reason_id,"onUpdate:modelValue":_=>n.stock_adjustment_reason_id=_,options:{placeholder:t.$t("stock-adjustment.selectReason")},class:k(["w-[150px]",{"border-red-500":a.invalid(`products.${g}.stock_adjustment_reason_id`)}]),disabled:n.initial_quantity<1},{default:b(()=>[s[3]||(s[3]=e("option",null,null,-1)),(l(!0),d(S,null,E(x.value,_=>(l(),d("option",{value:_.id},o(_.title),9,Ot))),256))]),_:2},1032,["modelValue","onUpdate:modelValue","options","disabled","class"])]),a.invalid(`products.${g}.stock_adjustment_reason_id`)?(l(),d("div",Jt,o(a.getError(`products.${g}.stock_adjustment_reason_id`)),1)):v("",!0)]),e("td",Wt,[e("button",{onClick:_=>I(g),class:"bg-red-100 p-2 rounded-md"},[i(c(T),{icon:"Trash2",class:"w-4 h-4 text-[#cf2c47]"})],8,Yt)])]))),128))])])):v("",!0)])])])])]),e("div",Zt,[i(c(A),{variant:"primary",onClick:m,class:"mr-2 mt-2 shadow-md"},{default:b(()=>[C(o(t.$t("stock-adjustment.createStockAdjustment")),1)]),_:1})])])])])]),p.isloading?(l(),d("div",Gt,[i(et,{class:"absolute flex items-center justify-center w-full h-full top-0",margin:"0px",loading:!0,color:"#fff",size:"50px"})])):v("",!0)],64))}};export{Kt as default};
